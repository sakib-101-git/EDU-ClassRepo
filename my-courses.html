<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Courses - EDU ClassRepo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-book-reader"></i>
                EDU ClassRepo
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="user-name">Loading...</div>
                    <div class="user-role" id="user-role">-</div>
                </div>
                <a href="settings.html" class="profile-avatar" id="profile-avatar" title="Account Settings">
                    <i class="fas fa-user-circle" style="font-size: 24px; color: #5c6b7a;"></i>
                </a>
            </div>
        </header>

        <div class="app-body">
            <!-- Sidebar -->
            <nav class="sidebar"></nav>

            <!-- Main Content -->
            <main class="main-content">
                <div class="page-header">
                    <h1 class="page-title">My Enrolled Courses</h1>
                    <div class="filter-controls">
                        <!-- Search Box -->
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="search-input" 
                                   placeholder="Search your courses..." onkeyup="searchCourses()">
                        </div>
                    </div>
                </div>

                <!-- Course Grid -->
                <div class="course-grid" id="course-grid"></div>
            </main>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        const user = checkAuth();
        
        if (user && user.role === 'admin') {
            window.location.href = 'dashboard.html';
        }
        
        const deptColors = {
            'CSE': 'course-cse',
            'EEE': 'course-eee',
            'BBA': 'course-bba',
            'ENG': 'course-eng',
            'LAW': 'course-law',
            'PHA': 'course-pha'
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadHeader();
            loadSidebar('my-courses');
            loadMyCourses();
        });

        function loadMyCourses() {
            const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || '';
            let courses = getEnrolledCourses();
            
            // Apply search filter
            if (searchTerm) {
                courses = courses.filter(c => 
                    c.code.toLowerCase().includes(searchTerm) ||
                    c.title.toLowerCase().includes(searchTerm) ||
                    (c.instructor && c.instructor.toLowerCase().includes(searchTerm))
                );
            }
            
            const grid = document.getElementById('course-grid');
            
            if (courses.length === 0) {
                const isSearching = searchTerm.length > 0;
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-${isSearching ? 'search' : 'book'}"></i>
                        <h3>${isSearching ? 'No matching courses' : 'No courses enrolled'}</h3>
                        <p>${isSearching ? 'Try a different search term.' : 'You haven\'t enrolled in any courses yet.'}</p>
                        ${!isSearching ? `
                            <a href="dashboard.html" class="btn btn-primary mt-20">
                                <i class="fas fa-search"></i> Browse Courses
                            </a>
                        ` : ''}
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = courses.map(course => {
                const fileCount = getCourseFiles(course.id).length;
                const colorClass = deptColors[course.dept] || '';
                
                return `
                    <div class="course-card ${colorClass}" onclick="window.location.href='course.html?id=${course.id}'">
                        <div class="card-header">
                            <h3>${course.code}: ${course.title}</h3>
                            <span><i class="fas fa-user-tie"></i> ${course.instructor || 'TBA'}</span>
                        </div>
                        <div class="card-body">
                            <p><i class="fas fa-file-alt"></i> ${fileCount} file${fileCount !== 1 ? 's' : ''} available</p>
                            <p style="color: var(--text-light); font-size: 13px;">
                                <i class="fas fa-mouse-pointer"></i> Click to view files
                            </p>
                        </div>
                        <div class="card-footer">
                            <span><i class="fas fa-building"></i> ${course.dept}</span>
                            <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); unenrollFromCourse(${course.id})">
                                <i class="fas fa-minus"></i> Unenroll
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function searchCourses() {
            loadMyCourses();
        }
    </script>
</body>
</html>
