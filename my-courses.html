<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Courses - EDU ClassRepo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-book-reader"></i>
                EDU ClassRepo
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="user-name">Loading...</div>
                    <div class="user-role" id="user-role">-</div>
                </div>
                <a href="settings.html" class="profile-avatar" title="Settings">
                    <i class="fas fa-user-circle" style="font-size: 24px; color: #5c6b7a;"></i>
                </a>
            </div>
        </header>

        <div class="app-body">
            <!-- Sidebar -->
            <nav class="sidebar"></nav>

            <!-- Main Content -->
            <main class="main-content">
                <div class="page-header">
                    <h1 class="page-title">My Enrolled Courses</h1>
                    <div class="filter-controls">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="search-input" 
                                   placeholder="Search your courses..." onkeyup="searchCourses()">
                        </div>
                    </div>
                </div>

                <!-- Course Grid -->
                <div class="course-grid" id="course-grid">
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Loading courses...</h3>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        /*
         * My Courses Page Script
         */
        
        const user = checkAuth();
        let myCourses = [];
        
        // Redirect admin to dashboard
        if (user?.role === 'admin') {
            window.location.href = 'dashboard.html';
        }
        
        // Department color classes
        const deptColors = {
            'CSE': 'course-cse',
            'EEE': 'course-eee',
            'BBA': 'course-bba',
            'ENG': 'course-eng',
            'ECO': 'course-eco',
            'GED': 'course-ged'
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            loadHeader();
            loadSidebar('my-courses');
            await loadMyCourses();
        });

        // Load enrolled courses from API
        async function loadMyCourses() {
            myCourses = await loadEnrollments();
            renderCourses();
        }

        // Render course cards
        function renderCourses() {
            const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || '';
            let courses = myCourses;
            
            // Apply search filter
            if (searchTerm) {
                courses = courses.filter(c => 
                    c.code.toLowerCase().includes(searchTerm) ||
                    c.title.toLowerCase().includes(searchTerm)
                );
            }
            
            const grid = document.getElementById('course-grid');
            
            // Show empty state
            if (courses.length === 0) {
                const isSearching = searchTerm.length > 0;
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-${isSearching ? 'search' : 'book'}"></i>
                        <h3>${isSearching ? 'No matching courses' : 'No courses enrolled'}</h3>
                        <p>${isSearching ? 'Try a different search.' : 'You haven\'t enrolled in any courses yet.'}</p>
                        ${!isSearching ? `
                            <a href="dashboard.html" class="btn btn-primary mt-20">
                                <i class="fas fa-search"></i> Browse Courses
                            </a>
                        ` : ''}
                    </div>
                `;
                return;
            }
            
            // Render course cards
            grid.innerHTML = courses.map(course => {
                const colorClass = deptColors[course.department] || '';
                
                return `
                    <div class="course-card ${colorClass}" onclick="window.location.href='course.html?id=${course.id}'">
                        <div class="card-header">
                            <h3>${course.code}: ${course.title}</h3>
                            <span><i class="fas fa-user-tie"></i> ${course.instructor || 'TBA'}</span>
                        </div>
                        <div class="card-body">
                            <p style="color: var(--text-light); font-size: 13px;">
                                <i class="fas fa-mouse-pointer"></i> Click to view files
                            </p>
                        </div>
                        <div class="card-footer">
                            <span><i class="fas fa-building"></i> ${course.department}</span>
                            <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); handleUnenroll(${course.id})">
                                <i class="fas fa-minus"></i> Unenroll
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Search courses
        function searchCourses() {
            renderCourses();
        }

        // Handle unenroll
        async function handleUnenroll(courseId) {
            if (await unenrollCourse(courseId)) {
                await loadMyCourses();
            }
        }
    </script>
</body>
</html>
